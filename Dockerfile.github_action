FROM python:3.12.10-slim AS base

RUN apt-get update && apt-get install --no-install-recommends -y git curl && apt-get clean && rm -rf /var/lib/apt/lists/*

WORKDIR /app
ADD pyproject.toml .
ADD requirements.txt .
RUN pip install uv && uv pip install --no-cache-dir . && rm pyproject.toml requirements.txt
ENV PYTHONPATH=/app
ADD docs docs
ADD pr_agent pr_agent
ADD github_action/entrypoint.sh /

ENV config.model="gpt-5" \
    config.fallback_models="[]" \
    config.allow_dynamic_context="true" \
    config.patch_extra_lines_before="3" \
    config.patch_extra_lines_after="1" \
    config.max_model_tokens="200000" \
    config.custom_model_max_tokens="200000" \
    # ignore noisy file types across all tools (/review, /improve, etc.)
    ignore.glob="['*.txt','*.json']" \
    # reasoning control (see note below)
    config.reasoning_effort="high"

RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
